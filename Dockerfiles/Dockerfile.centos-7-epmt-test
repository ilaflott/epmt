FROM centos:7

WORKDIR /home
RUN yum update -y
RUN yum install -y make tcsh
RUN yum clean all
RUN rm -rf /var/cache/yum

ARG release=epmt-2.0.0.tgz
ADD ${release} /opt/epmt/
ADD test-${release} .
WORKDIR /home/epmt-install-tests
ENV PATH="/opt/epmt/epmt-install/epmt:${PATH}"

# Allow perf events
# RUN echo -e "#!/bin/bash\nmount -o remount rw /proc\nsysctl -w kernel.perf_event_paranoid=0\n\$\*" > /tmp/init.sh
# CMD ["/bin/bash","/tmp/init.sh","make","check-python-shells"]
# Unit tests not supported because python3 and requirements not installed

CMD ["make","check-python-shells"]